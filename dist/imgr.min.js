/*! imgr.js - v1.0.0 - 2014-01-26
* https://github.com/agaase/
* Copyright (c) 2014 agaase; Licensed MIT */
!function(a){var b,c,d="touchmove.imgr mousewheel.imgr",e="imgr",f="imgrrd",g="imgrr",h="imgr:error loading image",i=[],j=250,k=!1,l=!1,m=!1,n=function(){var b=0;a(window).bind(d,function(){b&&clearTimeout(b),i.length?b=setTimeout(function(){var a=0,b=setInterval(function(){3>a?(o(),a++):clearInterval(b)},1e3)},100):i.length||setTimeout(function(){a("."+e+",."+g,c).length||(a(window).unbind(d),k=!1)},5e3)})},o=function(){if(!l){l=!0;for(var b=0;b<i.length;b++){var c=a(i[b]);(m||p(c))&&(r(c),i.splice(b,1),b--)}l=!1}},p=function(a){var c={top:b.scrollTop(),left:b.scrollLeft()};c.right=c.left+b.width(),c.bottom=c.top+b.height();var d=a.offset();return d.right=d.left+a.outerWidth(),d.bottom=d.top+a.outerHeight(),c.right<d.left-j||c.left>d.right+j||c.bottom<d.top-j||c.top>d.bottom+j?void 0:!0},q=function(a,b,c){b.hasClass(f)||("div"===a?b.css("background-image","url("+c+")"):b.attr("src",c),b.removeClass(g),b.addClass(f),b.animate({opacity:1},2e3),setTimeout(function(){b.css("background-color","inherit")},300))},r=function(b){var c=""+b.attr("data-src");if(c&&c.length>0){var d=b.attr("tagName");void 0===d&&(d=b.prop("tagName")),d=d.toLowerCase(),a("<img/>").load(function(){q(d,b,c)}).ready(function(){q(d,b,c)}).error(function(){console.log(h)}).attr("src",c)}},s=function(){var b=a("."+e,c),d=(new Date).getTime();b.each(function(){var b=a(this);b.attr("id","imgr_"+d);b.offset();b.removeClass(e),b.addClass(g),b.css({opacity:"0.05","background-color":"grey"})}),i=i.length?a.merge(i,b):b};a.fn.imgr=function(d){c=a(a(this).length?this:"body"),b=a(window),d=d||{},m=d.atOnce||!1,s(),k||m||(n(),k=!0),o()}}($);