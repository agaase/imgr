/*! imgr.js - v1.0.0 - 2014-01-26
* https://github.com/agaase/
* Copyright (c) 2014 agaase; Licensed MIT */
!function(a){var b,c,d="touchmove.imgr mousewheel.imgr",e="imgr",f="imgrrd",g="imgrr",h="imgr:error loading image",i=[],j=!1,k=!1,l={},m=function(){var b=0;a(window).bind(d,function(){b&&clearTimeout(b),i.length?b=setTimeout(function(){var a=0,b=setInterval(function(){3>a?(n(),a++):clearInterval(b)},1e3)},100):i.length||setTimeout(function(){a("."+e+":not(."+f+"),."+g+":not(."+f+")",c).length||(a(window).unbind(d),j=!1)},5e3)})},n=function(){if(!k){k=!0;for(var b=0;b<i.length;b++){var c=a(i[b]);(l.atOnce||o(c))&&(q(c),i.splice(b,1),b--)}k=!1}},o=function(a){var c={top:b.scrollTop(),left:b.scrollLeft()};c.right=c.left+b.width(),c.bottom=c.top+b.height();var d=a.offset();return d.right=d.left+a.outerWidth(),d.bottom=d.top+a.outerHeight(),c.right<d.left-l.margin||c.left>d.right+l.margin||c.bottom<d.top-l.margin||c.top>d.bottom+l.margin?void 0:!0},p=function(a,b,c){b.hasClass(f)||("div"===a?b.css("background-image","url("+c+")"):b.attr("src",c),b.removeClass(g),b.addClass(f),b.animate({opacity:1},2e3),setTimeout(function(){b.css("background-color","inherit")},300))},q=function(b){var c=""+b.attr("data-src");if(c&&c.length>0){var d=b.attr("tagName");void 0===d&&(d=b.prop("tagName")),d=d.toLowerCase(),a("<img/>").load(function(){p(d,b,c)}).ready(function(){p(d,b,c)}).error(function(){console.log(h)}).attr("src",c)}},r=function(a){a=a||{},l.atOnce=a.atOnce||!1,l.margin="undefined"!=typeof a.margin?a.margin:100},s=function(){var b=a("."+e,c),d=(new Date).getTime();b.each(function(b){var c=a(this);c.attr("id","imgr_"+b+"_"+d).addClass(g).css({opacity:"0.05","background-color":"grey","min-height":(c.height()||150)+"px","min-width":(c.width()||150)+"px"}),c.width()||c.css("min-width","100px")}),i=i.length?a.merge(i,b):b};a.fn.imgr=function(d){c=a(a(this).length?this:"body"),b=a(window),r(d),s(),j||l.atOnce||(m(),j=!0),n()}}($);